function checkEventPackage(a){a.eventPackage||(a.eventPackage={context:null,events:{},cacheKey:0,cache:{},flags:{memory:{},memoryLast:{},once:{},clear:{},stopOnFalse:{}},onceRun:{},memoryCache:{}})}function triggerEvent(a,b){var c=this.newEvent.eventPackage,d=c.events[a],e=c.context,f=[],g,h;if(d)if(c.flags.stopOnFalse[a]){for(g=0,h=d.length;g<h;g++)if((f[g]=d[g].apply(e,b))===!1)break}else for(g=0,h=d.length;g<h;g++)f[g]=d[g].apply(e,b);return f}module.exports={newEvent:function(){var a=function(b,c){checkEventPackage(a);var d=a.eventPackage,e=d.flags;d.context=this;for(var f in c)e[f][b]=!0;c.once&&(d.onceRun[b]=!0);if(c.memoryLast||c.memory)d.memoryCache[b]=[]};return a.eventPackage=null,a.setEventContext=function(b){checkEventPackage(a),this.eventPackage.context=b},a}(),addEvent:function(a,b,c){b.level=c||0;var d=this.newEvent.eventPackage,e=d.events,f=d.flags,g=d.context;(e[a]||(e[a]=[])).push(b),e[a].sort(function(a,b){return b.level-a.level});if(f.memoryLast[a]||f.memory[a]){var h=d.memoryCache[a];for(var i=0,j=h.length;i<j;i++)b.apply(g,h[i])}return d.cache[++d.cacheKey]=[a,b],d.cacheKey},addEventAsync:function(a,b,c,d){var e=this.newEvent.eventPackage.cache,f;return f=this.addEvent(a,function(){var a=e[f];c&&a[2]&&clearTimeout(a[2]);var d=arguments,g=this,h={type:"asyncResult",value:null,list:[],get:function(a){this.list?this.list.push(a):a(this.value)},set:function(a){this.value=a;for(var b=0,c=this.list.length;b<c;b++)this.list[b](a);delete this.list}};return a[2]=setTimeout(function(){a[2]=null,h.set(b.apply(g,d))},1),h},d)},removeEvent:function(){var a;if(!(a=this.newEvent.eventPackage))return!1;var b=a.events,c=a.cache,d=arguments[0],e=typeof d,f=arguments[1],g=typeof f,h,i,j,k;if(e==="number")c[d]&&arguments.callee.apply(this,c[d]);else if(e==="string"&&g==="function"){k=b[d];for(h=0,i=k.length;h<i;h++)if(f===k[h]){k.splice(h,1);break}for(j in c)if(d===c[j][0]&&f===c[j][1]){delete c[j];break}}else if(e==="string"&&g==="undefined"){b[d]=[];for(j in c)d===c[j][0]&&delete c[j]}else e==="undefined"&&(a.events={},a.cache={})},triggerEvent:function(a){var b=Array.prototype.slice.call(arguments,1),c=!0,d=this.newEvent.eventPackage,e=d.flags;if(e.once[a])if(d.onceRun[a]){delete d.onceRun[a];if(e.memoryLast[a]||e.memory[a])d.memoryCache[a]=[b]}else c=!1;else e.memoryLast[a]?d.memoryCache[a]=[b]:e.memory[a]&&d.memoryCache[a].push(b);var f=[];return c&&(f=triggerEvent.call(this,a,b)),e.clear[a]&&this.removeEvent(a),f}}